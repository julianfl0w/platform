networks:
  default:
    name: opentdf_platform
services:
  opentdf:
    container_name: opentdf
    image: opentdf:latest
    restart: always
    environment:
      KEYCLOAK_BASE_URL: http://keycloak:8888
    ports:
      - "8080:8080"
    command: start
    volumes:
      - ./opentdf.yaml:/app/opentdf.yaml
      - ./kas-cert.pem:/app/kas-cert.pem
      - ./kas-ec-cert.pem:/app/kas-ec-cert.pem
      - ./kas-private.pem:/app/kas-private.pem
      - ./kas-ec-private.pem:/app/kas-ec-private.pem
    healthcheck:
      test: ["CMD-SHELL", "curl -sf http://keycloak:8888 && curl -sf http://opentdfdb:5432 || exit 1"]
      interval: 10s
      timeout: 5s
      retries: 5
